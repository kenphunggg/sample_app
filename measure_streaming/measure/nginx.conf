# Minimal nginx configuration for HLS streaming in Knative

# A minimal events block is required.
events {
    worker_connections 1024;
}

http {
    # Define the MIME types for HLS files.
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    server {
        # This is the most important line. It MUST be 8080 for Knative.
        listen 8080;
        server_name localhost;

        # This block serves your HLS stream.
        # It matches the URL path, e.g., http://.../live/playlist.m3u8
        location /live/ {
            
            # This points to the directory where FFmpeg saves the files.
            alias /var/www/hls/;

            # Add headers required for HLS streaming.
            add_header Cache-Control no-cache;
            add_header Access-Control-Allow-Origin *;
        }
    }
}